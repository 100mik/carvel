<!DOCTYPE html>
<!-- docs/baseof.html -->
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">

    <link rel="icon" type="image/png" href="/img/favicon.png">
    
    
    <link rel="stylesheet" href="/css/style.css" integrity="" media="screen">
    <script src="/js/main.js" type="text/javascript"></script>
    
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" /> 
  
    
      
      <meta name="robots" content="noindex">
    
    <title>Carvel - kapp - Apply stage</title>
  </head>

  <body id="docs">
    

<header class="in-subproject">
	<div class="wrapper">
		<a href="/"><img class="image" src="/img/logo.svg" alt="Carvel Logo" /></a>
		<ul class="desktop-links">
			<li><a href="/" >Home</a></li>
			<li class="subprojects-in-primary-nav">
				<a href="/" onclick="return false;">Projects</a>
				<ul>
					
					
					<li><a href="/ytt/" >ytt</a></li>
					
					
					<li><a href="/kbld/" >kbld</a></li>
					
					
					<li><a href="/kapp/" >kapp</a></li>
					
					
					<li><a href="/imgpkg/" >imgpkg</a></li>
					
					
					<li><a href="https://github.com/vmware-tanzu/carvel-kapp-controller" >kapp-controller</a></li>
					
					
					<li><a href="/vendir/" >vendir</a></li>
					
				</ul>
			</li>
			<li><a href="/community/" >Community</a></li>
			<li><a href="/blog/" >Blog</a></li>
			<li><a href="https://kubernetes.slack.com/archives/CH8KCCKA5"><img src="/img/slack.png" />#carvel in Kubernetes Slack</a></li>
		</ul>
		<button type="button" class="mobile" onclick="mobileNavToggle()">
			<img class="collapsed-icon" src="/img/hamburger.svg" alt="Mobile nav icon">
			<img class="expanded-icon" src="/img/close.svg" alt="Mobile nav icon">
		</button>
		<div id="mobile-menu" class="mobile-menu mobile">
			<ul class="header-links">
				<li><a href="/" >Home</a></li>
				<li>
					<a href="/">Projects</a>
					<ul>
						
						
						<li><a href="/ytt/" >ytt</a></li>
						
						
						<li><a href="/kbld/" >kbld</a></li>
						
						
						<li><a href="/kapp/" >kapp</a></li>
						
						
						<li><a href="/imgpkg/" >imgpkg</a></li>
						
						
						<li><a href="https://github.com/vmware-tanzu/carvel-kapp-controller" >kapp-controller</a></li>
						
						
						<li><a href="/vendir/" >vendir</a></li>
						
					</ul>
				</li>
				<li><a href="/community/" >Community</a></li>
				<li><a href="/blog/" >Blog</a></li>
			</ul>
			<div class="social">
				<a href="https://github.com/vmware-tanzu/carvel.dev"><img src="/img/github.svg" />GitHub</a>
				<a href="https://kubernetes.slack.com/archives/CH8KCCKA5"><img src="/img/slack.png" />#carvel in Kubernetes Slack</a>
			</div>
		</div>
	</div>
</header>



<header class="subproject-specific">
	<div class="wrapper">
		<a href="/kapp/" class="text-logo">kapp</a>
		<ul class="desktop-links">
			<li><a href="/kapp/" >kapp Overview</a></li>
			<li><a href="/kapp/docs/latest/" >Documentation</a></li>
			<li><a href="https://github.com/vmware-tanzu/carvel-kapp"><img src="/img/github.svg" />GitHub</a></li>
		</ul>
		<ul class="mobile-links mobile">
			<li><a href="/kapp/docs/latest/" >Docs</a></li>
			<li><a href="https://github.com/vmware-tanzu/carvel-kapp"><img src="/img/github.svg" />GitHub</a></li>
		</ul>
	</div>
</header>


    <main>
      <div class="wrapper dedicated-page docs clearfix">
        <div class="side-nav">
          
<div class="dropdown">
    
        <span>latest</span>
    
</div>

          
    
    <form class="d-flex align-items-center">
        <span class="algolia-autocomplete" style="position: relative; display: inline-block; direction: ltr;">
        <input type="search" class="form-control docsearch-input" id="search-input" placeholder="Search..."
                aria-label="Search for..." autocomplete="off" spellcheck="false" role="combobox"
                aria-autocomplete="list" aria-expanded="false" aria-owns="algolia-autocomplete-listbox-0"
                dir="auto" style="position: relative; vertical-align: top;">
        </span>
    </form>

          <nav class="navigation">
  
  
  
  
    
    
    
    

    
      <h3>Introduction</h3>
      <ul>
        
          <li>
            
              
              <a href="/kapp/docs/latest/" >About kapp</a>
            
          </li>
        
          <li>
            
              
              <a href="/kapp/docs/latest/apps/" >Applications</a>
            
          </li>
        
      </ul>
    
      <h3>Deploy command</h3>
      <ul>
        
          <li>
            
              
              <a href="/kapp/docs/latest/diff/" >Diff stage</a>
            
          </li>
        
          <li>
            
              
              <a href="/kapp/docs/latest/apply/" class="active">Apply stage</a>
            
          </li>
        
          <li>
            
              
              <a href="/kapp/docs/latest/apply-ordering/" >Apply Ordering</a>
            
          </li>
        
          <li>
            
              
              <a href="/kapp/docs/latest/apply-waiting/" >Apply Waiting</a>
            
          </li>
        
      </ul>
    
      <h3>Reference</h3>
      <ul>
        
          <li>
            
              
              <a href="/kapp/docs/latest/config/" >Configuration</a>
            
          </li>
        
          <li>
            
              
              <a href="/kapp/docs/latest/rbac/" >Permissions</a>
            
          </li>
        
          <li>
            
              
              <a href="/kapp/docs/latest/state-namespace/" >Namespace for State Storage</a>
            
          </li>
        
          <li>
            
              
              <a href="/kapp/docs/latest/cheatsheet/" >Cheatsheet</a>
            
          </li>
        
          <li>
            
              
              <a href="/kapp/docs/latest/dangerous-flags/" >Dangerous Flags</a>
            
          </li>
        
      </ul>
    
      <h3>Integrations</h3>
      <ul>
        
          <li>
            
              
              <a href="/kapp/docs/latest/integrating-with-other-tools/" >Integrating With Other Tools</a>
            
          </li>
        
          <li>
            
              
              <a href="/kapp/docs/latest/gitops/" >GitOps</a>
            
          </li>
        
      </ul>
    
      <h3>FAQ</h3>
      <ul>
        
          <li>
            
              
              <a href="/kapp/docs/latest/faq/" >FAQ</a>
            
          </li>
        
          <li>
            
              
              <a href="/kapp/docs/latest/merge-method/" >Resource Merge Method</a>
            
          </li>
        
          <li>
            
              
              <a href="/kapp/docs/latest/security/" >Security</a>
            
          </li>
        
      </ul>
    
  
</nav>

        </div>
        <div class="docs-content text-content">
          

	


          <div class="documentation-container">
            <h1>Apply stage</h1>
            
                <aside>
                <nav id="TableOfContents">
  <ul>
    <li><a href="#overview">Overview</a></li>
    <li><a href="#controlling-apply-via-resource-annotations">Controlling apply via resource annotations</a>
      <ul>
        <li><a href="#kappk14siocreate-strategy">kapp.k14s.io/create-strategy</a></li>
        <li><a href="#kappk14sioupdate-strategy">kapp.k14s.io/update-strategy</a></li>
        <li><a href="#kappk14siodelete-strategy">kapp.k14s.io/delete-strategy</a></li>
        <li><a href="#kappk14sioowned-for-deletion">kapp.k14s.io/owned-for-deletion</a></li>
        <li><a href="#kappk14siononce">kapp.k14s.io/nonce</a></li>
        <li><a href="#kappk14siodeploy-logs">kapp.k14s.io/deploy-logs</a></li>
        <li><a href="#kappk14siodeploy-logs-container-names">kapp.k14s.io/deploy-logs-container-names</a></li>
      </ul>
    </li>
    <li><a href="#controlling-apply-via-deploy-flags">Controlling apply via deploy flags</a></li>
  </ul>
</nav>
                </aside>
            

            <h2 id="overview">Overview <a href="#overview" class="section-link">¶</a></h2><p>Once change set is calculated (see <a href="/kapp/docs/latest/diff/">Diff</a> section for details), kapp asks for user confirmation (unless <code>--yes</code> flag is specified) to proceed with changes.</p>
<p>Changes are applied in particular order as described in <a href="/kapp/docs/latest/apply-ordering/">Apply ordering</a>.</p>
<p>All created resources are labeled with several labels:</p>
<ul>
<li><code>kapp.k14s.io/app</code> to track which application &ldquo;owns&rdquo; resource</li>
<li><code>kapp.k14s.io/identity</code> to identify preferred API version used when creating resource</li>
<li><code>kapp.k14s.io/association</code> to track (best effort) parent-child relationships between resources</li>
</ul>
<p>Every time application is deployed, new application change record is saved. They can be viewed via <code>kapp app-change ls -a app-name</code>.</p>
<p>Related: <a href="/kapp/docs/latest/config/#ownershiplabelrules">ownership label rules</a> and <a href="/kapp/docs/latest/config/#labelscopingrules">label scoping rules</a>.</p>
<h2 id="controlling-apply-via-resource-annotations">Controlling apply via resource annotations <a href="#controlling-apply-via-resource-annotations" class="section-link">¶</a></h2><h3 id="kappk14siocreate-strategy">kapp.k14s.io/create-strategy <a href="#kappk14siocreate-strategy" class="section-link">¶</a></h3><p><code>kapp.k14s.io/create-strategy</code> annotation controls create behaviour (rarely necessary)</p>
<p>Possible values: &quot;&quot; (default), <code>fallback-on-update</code>.</p>
<p>In some cases creation of a resource may conflict with that resource being created in the cluster by other means (often automated). An example of that is creation of default ServiceAccount by kapp racing with Kubernetes service accounts controller doing the same thing. By specifying <code>fallback-on-update</code> value, kapp will catch resource creation conflicts and apply resource as an update.</p>
<h3 id="kappk14sioupdate-strategy">kapp.k14s.io/update-strategy <a href="#kappk14sioupdate-strategy" class="section-link">¶</a></h3><p><code>kapp.k14s.io/update-strategy</code> annotation controls update behaviour</p>
<p>Possible values: &quot;&quot; (default), <code>fallback-on-replace</code>, <code>always-replace</code>, <code>skip</code>.</p>
<p>In some cases entire resources or subset resource fields are immutable which forces kapp users to specify how to apply wanted update.</p>
<ul>
<li>&quot;&quot; means to issue plain update call</li>
<li><code>fallback-on-replace</code> causes kapp to fallback to resource replacement if update call results in <code>Invalid</code> error. Note that if resource is replaced (= delete + create), it may be negatively affected (loss of persistent data, loss of availability, etc.). For example, if Deployment or DaemonSet is first deleted and then created then associated Pods will be recreated as well, but all at the same time (even if rolling update is enabled), which likely causes an availability gap.</li>
<li><code>always-replace</code> causes kapp to always delete and then create resource (See note above as well.)</li>
<li><code>skip</code> causes kapp to not apply update (it will show up in a diff next time). Available in v0.33.0+.</li>
</ul>
<h3 id="kappk14siodelete-strategy">kapp.k14s.io/delete-strategy <a href="#kappk14siodelete-strategy" class="section-link">¶</a></h3><p><code>kapp.k14s.io/delete-strategy</code> annotation controls deletion behaviour</p>
<p>Possible values: &quot;&quot; (default), <code>orphan</code>.</p>
<p>By default resource is deleted, however; choosing <code>orphan</code> value will make kapp forget about this resource. Note that if this resource is owned by a different resource that&rsquo;s being deleted, it might still get deleted. Orphaned resources are labeled with <code>kapp.k14s.io/orphaned</code> label. As of v0.31.0+, resource is also disassociated from owning app so that it can be owned by future apps.</p>
<h3 id="kappk14sioowned-for-deletion">kapp.k14s.io/owned-for-deletion <a href="#kappk14sioowned-for-deletion" class="section-link">¶</a></h3><p><code>kapp.k14s.io/owned-for-deletion</code> annotation controls resource deletion during <code>kapp delete</code> command</p>
<p>Possible values: &ldquo;&rdquo;.</p>
<p>By default non-kapp owned resources are not explicitly deleted by kapp, but expected to be deleted by the cluster (for example Endpoints resource for each Service). In some cases it&rsquo;s desired to annotate non-kapp owned resource so that it does get explicitly deleted, possibly because cluster does not plan to delete it (e.g. PVCs created by StatefulSet are not deleted by StatefulSet controller; <a href="https://github.com/vmware-tanzu/carvel-kapp/issues/36" target="_blank">https://github.com/vmware-tanzu/carvel-kapp/issues/36</a>).</p>
<h3 id="kappk14siononce">kapp.k14s.io/nonce <a href="#kappk14siononce" class="section-link">¶</a></h3><p><code>kapp.k14s.io/nonce</code> annotation allows to inject unique ID</p>
<p>Possible values: &quot;&quot; (default).</p>
<p>Annotation value will be replaced with a unique ID on each deploy. This allows to force resource update as value changes every time.</p>
<h3 id="kappk14siodeploy-logs">kapp.k14s.io/deploy-logs <a href="#kappk14siodeploy-logs" class="section-link">¶</a></h3><p><code>kapp.k14s.io/deploy-logs</code> annotation indicates which Pods' log output to show during deploy</p>
<p>Possible values:</p>
<ul>
<li>&quot;&quot; (default; equivalent to <code>for-new</code>)</li>
<li><code>for-new</code> (only newly created Pods are tailed)</li>
<li><code>for-existing</code> (only existing Pods are tailed)</li>
<li><code>for-new-or-existing</code> (both newly created and existing Pods are tailed)</li>
</ul>
<p>Especially useful when added to Jobs. For example, see <a href="https://github.com/vmware-tanzu/carvel-kapp/blob/develop/examples/resource-ordering/sync-check.yml" target="_blank">examples/resource-ordering/sync-check.yml</a></p>
<h3 id="kappk14siodeploy-logs-container-names">kapp.k14s.io/deploy-logs-container-names <a href="#kappk14siodeploy-logs-container-names" class="section-link">¶</a></h3><p><code>kapp.k14s.io/deploy-logs-container-names</code> annotation indicates which containers' log output to show during deploy</p>
<p>Possible values: &quot;&quot; (default), <code>containerName1</code>, <code>containerName1,containerName2</code></p>
<hr>
<h2 id="controlling-apply-via-deploy-flags">Controlling apply via deploy flags <a href="#controlling-apply-via-deploy-flags" class="section-link">¶</a></h2><ul>
<li><code>--apply-ignored=bool</code> explicitly applies ignored changes; this is useful in cases when controllers lose track of some resources instead of for example deleting them</li>
<li><code>--apply-default-update-strategy=string</code> controls default strategy for all resources (see <code>kapp.k14s.io/update-strategy</code> annotation above)</li>
<li><code>--apply-exit-status=bool</code> (default <code>false</code>) controls exit status (<code>0</code>: unused, <code>1</code>: any error, <code>2</code>: no changes applied, <code>3</code>: at least one change applied)</li>
<li><code>--wait=bool</code> (default <code>true</code>) controls whether kapp will wait for resource to &ldquo;stabilize&rdquo;. See <a href="/kapp/docs/latest/apply-waiting/">Apply waiting</a></li>
<li><code>--wait-ignored=bool</code> controls whether kapp will wait for ignored changes (regardless whether they were initiated by kapp or by controllers)</li>
<li><code>--logs=bool</code> (default <code>true</code>) controls whether to show logs as part of deploy output for Pods annotated with <code>kapp.k14s.io/deploy-logs: &quot;&quot;</code></li>
<li><code>--logs-all=bool</code> (deafult <code>false</code>) controls whether to show all logs as part of deploy output for all Pods</li>
</ul>

          </div>
        </div>
      </div>
    </main>
    <footer>
	<div class="wrapper footer-links">
		<div class="clearfix">
			<ul class="left-links">
				<li><a href="https://twitter.com/carvel_dev"><img src="/img/twitter.png" />Twitter</a></li>
				<li><a href="https://github.com/vmware-tanzu/carvel.dev"><img src="/img/github.svg" />Github</a></li>
				<li><a href="https://kubernetes.slack.com/archives/CH8KCCKA5">
					<img src="/img/slack.png" />
					<span class="desktop">#carvel in Kubernetes Slack</span>
					<span class="mobile">Slack</span>
				</a></li>
			</ul>
			<div class="right-links">
				<a href="/"> <img src="/img/logo.svg" /></a>
			</div>
		</div>
		<div class="bottom-links">
			<p class="copywrite">&copy; 2021 Carvel Authors. <a href="http://vmware.github.io/">A VMware-backed project. <img src="/img/vm-logo.svg" /></a></p>
		</div>
	</div>
</footer>

    
    
      <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
      <script type="text/javascript">
        docsearch({
          apiKey: '582b1408d7a3fe145c0f84f48ca03755',
          indexName: 'carvel',
          inputSelector: '.docsearch-input',
          algoliaOptions: {'facetFilters': ["tags:kapp"], hitsPerPage: 9},
          debug: false 
        });
      </script>
    
  </body>
</html>
