<!DOCTYPE html>
<!-- docs/baseof.html -->
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">

    <link rel="icon" type="image/png" href="/img/favicon.png">
    
    
    <link rel="stylesheet" href="/css/style.css" integrity="" media="screen">
    <script src="/js/main.js" type="text/javascript"></script>
    
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" /> 
  
    
      
      <meta name="robots" content="noindex">
    
    <title>Carvel - kapp - Diff stage</title>
  </head>

  <body id="docs">
    

<header class="in-subproject">
	<div class="wrapper">
		<a href="/"><img class="image" src="/img/logo.svg" alt="Carvel Logo" /></a>
		<ul class="desktop-links">
			<li><a href="/" >Home</a></li>
			<li class="subprojects-in-primary-nav">
				<a href="/" onclick="return false;">Projects</a>
				<ul>
					
					
					<li><a href="/ytt/" >ytt</a></li>
					
					
					<li><a href="/kbld/" >kbld</a></li>
					
					
					<li><a href="/kapp/" >kapp</a></li>
					
					
					<li><a href="/imgpkg/" >imgpkg</a></li>
					
					
					<li><a href="https://github.com/vmware-tanzu/carvel-kapp-controller" >kapp-controller</a></li>
					
					
					<li><a href="/vendir/" >vendir</a></li>
					
				</ul>
			</li>
			<li><a href="/community/" >Community</a></li>
			<li><a href="/blog/" >Blog</a></li>
			<li><a href="https://kubernetes.slack.com/archives/CH8KCCKA5"><img src="/img/slack.png" />#carvel in Kubernetes Slack</a></li>
		</ul>
		<button type="button" class="mobile" onclick="mobileNavToggle()">
			<img class="collapsed-icon" src="/img/hamburger.svg" alt="Mobile nav icon">
			<img class="expanded-icon" src="/img/close.svg" alt="Mobile nav icon">
		</button>
		<div id="mobile-menu" class="mobile-menu mobile">
			<ul class="header-links">
				<li><a href="/" >Home</a></li>
				<li>
					<a href="/">Projects</a>
					<ul>
						
						
						<li><a href="/ytt/" >ytt</a></li>
						
						
						<li><a href="/kbld/" >kbld</a></li>
						
						
						<li><a href="/kapp/" >kapp</a></li>
						
						
						<li><a href="/imgpkg/" >imgpkg</a></li>
						
						
						<li><a href="https://github.com/vmware-tanzu/carvel-kapp-controller" >kapp-controller</a></li>
						
						
						<li><a href="/vendir/" >vendir</a></li>
						
					</ul>
				</li>
				<li><a href="/community/" >Community</a></li>
				<li><a href="/blog/" >Blog</a></li>
			</ul>
			<div class="social">
				<a href="https://github.com/vmware-tanzu/carvel.dev"><img src="/img/github.svg" />GitHub</a>
				<a href="https://kubernetes.slack.com/archives/CH8KCCKA5"><img src="/img/slack.png" />#carvel in Kubernetes Slack</a>
			</div>
		</div>
	</div>
</header>



<header class="subproject-specific">
	<div class="wrapper">
		<a href="/kapp/" class="text-logo">kapp</a>
		<ul class="desktop-links">
			<li><a href="/kapp/" >kapp Overview</a></li>
			<li><a href="/kapp/docs/latest/" >Documentation</a></li>
			<li><a href="https://github.com/vmware-tanzu/carvel-kapp"><img src="/img/github.svg" />GitHub</a></li>
		</ul>
		<ul class="mobile-links mobile">
			<li><a href="/kapp/docs/latest/" >Docs</a></li>
			<li><a href="https://github.com/vmware-tanzu/carvel-kapp"><img src="/img/github.svg" />GitHub</a></li>
		</ul>
	</div>
</header>


    <main>
      <div class="wrapper dedicated-page docs clearfix">
        <div class="side-nav">
          
<div class="dropdown">
    
        <span>latest</span>
    
</div>

          
    
    <form class="d-flex align-items-center">
        <span class="algolia-autocomplete" style="position: relative; display: inline-block; direction: ltr;">
        <input type="search" class="form-control docsearch-input" id="search-input" placeholder="Search..."
                aria-label="Search for..." autocomplete="off" spellcheck="false" role="combobox"
                aria-autocomplete="list" aria-expanded="false" aria-owns="algolia-autocomplete-listbox-0"
                dir="auto" style="position: relative; vertical-align: top;">
        </span>
    </form>

          <nav class="navigation">
  
  
  
  
    
    
    
    

    
      <h3>Introduction</h3>
      <ul>
        
          <li>
            
              
              <a href="/kapp/docs/latest/" >About kapp</a>
            
          </li>
        
          <li>
            
              
              <a href="/kapp/docs/latest/apps/" >Applications</a>
            
          </li>
        
      </ul>
    
      <h3>Deploy command</h3>
      <ul>
        
          <li>
            
              
              <a href="/kapp/docs/latest/diff/" class="active">Diff stage</a>
            
          </li>
        
          <li>
            
              
              <a href="/kapp/docs/latest/apply/" >Apply stage</a>
            
          </li>
        
          <li>
            
              
              <a href="/kapp/docs/latest/apply-ordering/" >Apply Ordering</a>
            
          </li>
        
          <li>
            
              
              <a href="/kapp/docs/latest/apply-waiting/" >Apply Waiting</a>
            
          </li>
        
      </ul>
    
      <h3>Reference</h3>
      <ul>
        
          <li>
            
              
              <a href="/kapp/docs/latest/config/" >Configuration</a>
            
          </li>
        
          <li>
            
              
              <a href="/kapp/docs/latest/rbac/" >Permissions</a>
            
          </li>
        
          <li>
            
              
              <a href="/kapp/docs/latest/state-namespace/" >Namespace for State Storage</a>
            
          </li>
        
          <li>
            
              
              <a href="/kapp/docs/latest/cheatsheet/" >Cheatsheet</a>
            
          </li>
        
          <li>
            
              
              <a href="/kapp/docs/latest/dangerous-flags/" >Dangerous Flags</a>
            
          </li>
        
      </ul>
    
      <h3>Integrations</h3>
      <ul>
        
          <li>
            
              
              <a href="/kapp/docs/latest/integrating-with-other-tools/" >Integrating With Other Tools</a>
            
          </li>
        
          <li>
            
              
              <a href="/kapp/docs/latest/gitops/" >GitOps</a>
            
          </li>
        
      </ul>
    
      <h3>FAQ</h3>
      <ul>
        
          <li>
            
              
              <a href="/kapp/docs/latest/faq/" >FAQ</a>
            
          </li>
        
          <li>
            
              
              <a href="/kapp/docs/latest/merge-method/" >Resource Merge Method</a>
            
          </li>
        
          <li>
            
              
              <a href="/kapp/docs/latest/security/" >Security</a>
            
          </li>
        
      </ul>
    
  
</nav>

        </div>
        <div class="docs-content text-content">
          

	


          <div class="documentation-container">
            <h1>Diff stage</h1>
            
                <aside>
                <nav id="TableOfContents">
  <ul>
    <li><a href="#overview">Overview</a></li>
    <li><a href="#diff-strategies">Diff strategies</a></li>
    <li><a href="#versioned-resources">Versioned Resources</a></li>
    <li><a href="#controlling-diff-via-resource-annotations">Controlling diff via resource annotations</a>
      <ul>
        <li><a href="#kappk14siodisable-original">kapp.k14s.io/disable-original</a></li>
      </ul>
    </li>
    <li><a href="#controlling-diff-via-deploy-flags">Controlling diff via deploy flags</a></li>
  </ul>
</nav>
                </aside>
            

            <h2 id="overview">Overview <a href="#overview" class="section-link">¶</a></h2><p>kapp compares resources specified in files against resources that exist in Kubernetes API. Once change set is calculated, it provides an option to apply it (see <a href="/kapp/docs/latest/apply/">Apply</a> section for further details).</p>
<p>There are four different types of operations: <code>create</code>, <code>update</code>, <code>delete</code>, <code>noop</code> (shown as empty). Seen in <code>Op</code> column of diff summary table. Additionally there is <code>Op strategy</code> column (shorted as <code>Op st.</code>), added in v0.31.0+, that shows supplemental information how operation will be performed (for example <code>fallback on replace</code> for <code>update</code> operation).</p>
<p>There are three different types of waiting: <code>reconcile</code> (waits until resource has converged to its desired state; see <a href="/kapp/docs/latest/apply-waiting/">apply waiting</a> for waiting semantics), <code>delete</code> (waits until resource is gone), <code>noop</code> (shown as empty). Seen in <code>Wait to</code> column of diff summary table.</p>
<h2 id="diff-strategies">Diff strategies <a href="#diff-strategies" class="section-link">¶</a></h2><p>There are two diff strategies used by kapp:</p>
<ol>
<li>
<p>kapp compares against last applied resource content (previously applied by kapp; stored in annotation <code>kapp.k14s.io/original</code>) <strong>if</strong> there were no outside changes done to the resource (i.e. done outside of kapp, for example, by another team member or controller); kapp tries to use this strategy as much as possible to produce more user-friendly diffs.</p>
</li>
<li>
<p>kapp compares against live resource content <strong>if</strong> it detects there were outside changes to the resource (hence, sometimes you may see a diff that shows several deleted fields even though these fields are not specified in the original file)</p>
</li>
</ol>
<p>Strategy is selected for each resource individually. You can control which strategy is used for all resources via <code>--diff-against-last-applied=bool</code> flag.</p>
<p>Related: <a href="/kapp/docs/latest/config/#rebaserules">rebase rules</a>.</p>
<h2 id="versioned-resources">Versioned Resources <a href="#versioned-resources" class="section-link">¶</a></h2><p>In some cases it&rsquo;s useful to represent an update to a resource as an entirely new resource. Common example is a workflow to update ConfigMap referenced by a Deployment. Deployments do not restart their Pods when ConfigMap changes making it tricky for wide variety of applications for pick up ConfigMap changes. kapp provides a solution for such scenarios, by offering a way to create uniquely named resources based on an original resource.</p>
<p>Anytime there is a change to a resource marked as a versioned resource, entirely new resource will be created instead of updating an existing resource. Additionally kapp follows configuration rules (default ones, and ones that can be provided as part of application) to find and update object references (since new resource name is not something that configuration author knew about).</p>
<p>To make resource versioned, add <code>kapp.k14s.io/versioned</code> annotation with an empty value. Created resource follow <code>{resource-name}-ver-{n}</code> naming pattern by incrementing <code>n</code> any time there is a change.</p>
<p>You can control number of kept resource versions via <code>kapp.k14s.io/num-versions=int</code> annotation.</p>
<p>Try deploying <a href="https://github.com/vmware-tanzu/carvel-kapp/tree/develop/examples/gitops/redis-with-configmap" target="_blank">redis-with-configmap example</a> and changing <code>ConfigMap</code> in a next deploy.</p>
<hr>
<h2 id="controlling-diff-via-resource-annotations">Controlling diff via resource annotations <a href="#controlling-diff-via-resource-annotations" class="section-link">¶</a></h2><h3 id="kappk14siodisable-original">kapp.k14s.io/disable-original <a href="#kappk14siodisable-original" class="section-link">¶</a></h3><p><code>kapp.k14s.io/disable-original</code> annotation controls whether to record provided resource copy (rarely wanted)</p>
<p>Possible values: &quot;&quot; (empty). In some cases it&rsquo;s not possible or wanted to record applied resource copy into its annotation <code>kapp.k14s.io/original</code>. One such case might be when resource is extremely lengthy (e.g. long ConfigMap or CustomResourceDefinition) and will exceed annotation value max length of 262144 bytes.</p>
<hr>
<h2 id="controlling-diff-via-deploy-flags">Controlling diff via deploy flags <a href="#controlling-diff-via-deploy-flags" class="section-link">¶</a></h2><p>Diff summary shows quick information about what&rsquo;s being changed:</p>
<ul>
<li><code>--diff-summary=bool</code> (default <code>true</code>) shows diff summary, listing how resources have changed</li>
</ul>
<p>Diff changes (line-by-line diffs) are useful for looking at actual changes:</p>
<ul>
<li><code>--diff-changes=bool</code> (<code>-c</code>) (default <code>false</code>) shows line-by-line diffs</li>
<li><code>--diff-context=int</code> (default <code>2</code>) controls number of lines to show around changed lines</li>
<li><code>--diff-mask=bool</code> (default <code>true</code>) controls whether to mask sensitive fields</li>
</ul>
<p>Controlling how diffing is done:</p>
<ul>
<li><code>--diff-against-last-applied=bool</code> (default <code>false</code>) forces kapp to use particular diffing strategy (see above)</li>
<li><code>--diff-run=bool</code> (default <code>false</code>) stops after showing diff information</li>
<li><code>--diff-exit-status=bool</code> (default <code>false</code>) controls exit status for diff runs (<code>0</code>: unused, <code>1</code>: any error, <code>2</code>: no changes, <code>3</code>: pending changes)</li>
</ul>

          </div>
        </div>
      </div>
    </main>
    <footer>
	<div class="wrapper footer-links">
		<div class="clearfix">
			<ul class="left-links">
				<li><a href="https://twitter.com/carvel_dev"><img src="/img/twitter.png" />Twitter</a></li>
				<li><a href="https://github.com/vmware-tanzu/carvel.dev"><img src="/img/github.svg" />Github</a></li>
				<li><a href="https://kubernetes.slack.com/archives/CH8KCCKA5">
					<img src="/img/slack.png" />
					<span class="desktop">#carvel in Kubernetes Slack</span>
					<span class="mobile">Slack</span>
				</a></li>
			</ul>
			<div class="right-links">
				<a href="/"> <img src="/img/logo.svg" /></a>
			</div>
		</div>
		<div class="bottom-links">
			<p class="copywrite">&copy; 2021 Carvel Authors. <a href="http://vmware.github.io/">A VMware-backed project. <img src="/img/vm-logo.svg" /></a></p>
		</div>
	</div>
</footer>

    
    
      <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
      <script type="text/javascript">
        docsearch({
          apiKey: '582b1408d7a3fe145c0f84f48ca03755',
          indexName: 'carvel',
          inputSelector: '.docsearch-input',
          algoliaOptions: {'facetFilters': ["tags:kapp"], hitsPerPage: 9},
          debug: false 
        });
      </script>
    
  </body>
</html>
