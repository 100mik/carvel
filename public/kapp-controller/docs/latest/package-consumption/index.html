<!DOCTYPE html>
<!-- docs/baseof.html -->
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">

    <link rel="icon" type="image/png" href="/img/favicon.png">
    
    
    <link rel="stylesheet" href="/css/style.css" integrity="" media="screen">
    <script src="/js/main.js" type="text/javascript"></script>
    
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" /> 
  
    
      
      <meta name="robots" content="noindex">
    
    <title>Carvel - kapp-controller - Package Consumption</title>
  </head>

  <body id="docs">
    

<header class="in-subproject">
	<div class="wrapper">
		<a href="/"><img class="image" src="/img/logo.svg" alt="Carvel Logo" /></a>
		<ul class="desktop-links">
			<li><a href="/" >Home</a></li>
			<li class="subprojects-in-primary-nav">
				<a href="/" onclick="return false;">Projects</a>
				<ul>
					
					
					<li><a href="/ytt/" >ytt</a></li>
					
					
					<li><a href="/kbld/" >kbld</a></li>
					
					
					<li><a href="/kapp/" >kapp</a></li>
					
					
					<li><a href="/imgpkg/" >imgpkg</a></li>
					
					
					<li><a href="https://github.com/vmware-tanzu/carvel-kapp-controller" >kapp-controller</a></li>
					
					
					<li><a href="/vendir/" >vendir</a></li>
					
				</ul>
			</li>
			<li><a href="/community/" >Community</a></li>
			<li><a href="/blog/" >Blog</a></li>
			<li><a href="https://kubernetes.slack.com/archives/CH8KCCKA5"><img src="/img/slack.png" />#carvel in Kubernetes Slack</a></li>
		</ul>
		<button type="button" class="mobile" onclick="mobileNavToggle()">
			<img class="collapsed-icon" src="/img/hamburger.svg" alt="Mobile nav icon">
			<img class="expanded-icon" src="/img/close.svg" alt="Mobile nav icon">
		</button>
		<div id="mobile-menu" class="mobile-menu mobile">
			<ul class="header-links">
				<li><a href="/" >Home</a></li>
				<li>
					<a href="/">Projects</a>
					<ul>
						
						
						<li><a href="/ytt/" >ytt</a></li>
						
						
						<li><a href="/kbld/" >kbld</a></li>
						
						
						<li><a href="/kapp/" >kapp</a></li>
						
						
						<li><a href="/imgpkg/" >imgpkg</a></li>
						
						
						<li><a href="https://github.com/vmware-tanzu/carvel-kapp-controller" >kapp-controller</a></li>
						
						
						<li><a href="/vendir/" >vendir</a></li>
						
					</ul>
				</li>
				<li><a href="/community/" >Community</a></li>
				<li><a href="/blog/" >Blog</a></li>
			</ul>
			<div class="social">
				<a href="https://github.com/vmware-tanzu/carvel.dev"><img src="/img/github.svg" />GitHub</a>
				<a href="https://kubernetes.slack.com/archives/CH8KCCKA5"><img src="/img/slack.png" />#carvel in Kubernetes Slack</a>
			</div>
		</div>
	</div>
</header>



<header class="subproject-specific">
	<div class="wrapper">
		<a href="https://github.com/vmware-tanzu/carvel-kapp-controller" class="text-logo">kapp-controller</a>
		<ul class="desktop-links">
			<li><a href="https://github.com/vmware-tanzu/carvel-kapp-controller" >kapp-controller Overview</a></li>
			<li><a href="/kapp-controller/docs/latest/" >Documentation</a></li>
			<li><a href="https://github.com/vmware-tanzu/carvel-kapp-controller"><img src="/img/github.svg" />GitHub</a></li>
		</ul>
		<ul class="mobile-links mobile">
			<li><a href="/kapp-controller/docs/latest/" >Docs</a></li>
			<li><a href="https://github.com/vmware-tanzu/carvel-kapp-controller"><img src="/img/github.svg" />GitHub</a></li>
		</ul>
	</div>
</header>


    <main>
      <div class="wrapper dedicated-page docs clearfix">
        <div class="side-nav">
          
<div class="dropdown">
    
        <span>latest</span>
    
</div>

          
    
    <form class="d-flex align-items-center">
        <span class="algolia-autocomplete" style="position: relative; display: inline-block; direction: ltr;">
        <input type="search" class="form-control docsearch-input" id="search-input" placeholder="Search..."
                aria-label="Search for..." autocomplete="off" spellcheck="false" role="combobox"
                aria-autocomplete="list" aria-expanded="false" aria-owns="algolia-autocomplete-listbox-0"
                dir="auto" style="position: relative; vertical-align: top;">
        </span>
    </form>

          <nav class="navigation">
  
  
  
  
    
    
    
    

    
      <h3>Introduction</h3>
      <ul>
        
          <li>
            
              
              <a href="/kapp-controller/docs/latest/" >About kapp-controller</a>
            
          </li>
        
          <li>
            
              
              <a href="/kapp-controller/docs/latest/install/" >Install</a>
            
          </li>
        
          <li>
            
              
              <a href="/kapp-controller/docs/latest/walkthrough/" >Walkthrough</a>
            
          </li>
        
      </ul>
    
      <h3>Reference</h3>
      <ul>
        
          <li>
            
              
              <a href="/kapp-controller/docs/latest/app-spec/" >App CR Spec</a>
            
          </li>
        
          <li>
            
              
              <a href="/kapp-controller/docs/latest/config/" >Configuration</a>
            
          </li>
        
          <li>
            
              
              <a href="/kapp-controller/docs/latest/controller-config/" >Controller Configuration</a>
            
          </li>
        
          <li>
            
              
              <a href="/kapp-controller/docs/latest/startup/" >Controller Startup</a>
            
          </li>
        
          <li>
            
              
              <a href="/kapp-controller/docs/latest/security-model/" >Security Model</a>
            
          </li>
        
          <li>
            
              
              <a href="/kapp-controller/docs/latest/dangerous-flags/" >Dangerous Flags</a>
            
          </li>
        
      </ul>
    
      <h3>Template steps</h3>
      <ul>
        
          <li>
            
              
              <a href="/kapp-controller/docs/latest/sops/" >Mozilla&#39;s sops</a>
            
          </li>
        
      </ul>
    
      <h3>Packaging (alpha)</h3>
      <ul>
        
          <li>
            
              
              <a href="/kapp-controller/docs/latest/packaging/" >Terminology &amp; APIs</a>
            
          </li>
        
          <li>
            
              
              <a href="/kapp-controller/docs/latest/install-alpha/" >Install</a>
            
          </li>
        
          <li>
            
              
              <a href="/kapp-controller/docs/latest/package-authoring/" >Authoring packages</a>
            
          </li>
        
          <li>
            
              
              <a href="/kapp-controller/docs/latest/package-consumption/" class="active">Consuming packages</a>
            
          </li>
        
      </ul>
    
      <h3>FAQ</h3>
      <ul>
        
          <li>
            
              
              <a href="/kapp-controller/docs/latest/security/" >Security</a>
            
          </li>
        
      </ul>
    
  
</nav>

        </div>
        <div class="docs-content text-content">
          

	


          <div class="documentation-container">
            <h1>Package Consumption</h1>
            
                <aside>
                <nav id="TableOfContents">
  <ul>
    <li><a href="#prerequisites">Prerequisites</a></li>
    <li><a href="#adding-package-repository">Adding package repository</a></li>
    <li><a href="#installing-a-package">Installing a package</a></li>
    <li><a href="#uninstalling-a-package">Uninstalling a package</a></li>
  </ul>
</nav>
                </aside>
            

            <p>Available in <a href="https://github.com/vmware-tanzu/carvel-kapp-controller/tree/dev-packaging/alpha-releases" target="_blank">v0.17.0-alpha.1+</a></p>
<p>Before jumping in, we recommend reading through the docs about the new <a href="/kapp-controller/docs/latest/packaging/">packaging
apis</a> to familiarize yourself with the YAML configuration used in these
workflows.</p>
<p>This workflow walks through the example contained in
the <a href="https://github.com/vmware-tanzu/carvel-kapp-controller/tree/dev-packaging/examples/packaging-demo" target="_blank"><code>packaging-demo</code></a>.</p>
<h2 id="prerequisites">Prerequisites <a href="#prerequisites" class="section-link">¶</a></h2><ul>
<li>You will need to <a href="/kapp-controller/docs/latest/install-alpha/">install the alpha release</a> on a Kubernetes cluster to go through the examples.</li>
<li>The instructions below assume <a href="/kapp/"><code>kapp</code></a> and <code>kubectl</code> are installed.</li>
</ul>
<h2 id="adding-package-repository">Adding package repository <a href="#adding-package-repository" class="section-link">¶</a></h2><p>kapp-controller needs to know which packages are available to install. One way to let it know about available packages is by registering a package repository. To do this, we need a PackageRepository CR:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#555">---</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#000080">apiVersion</span>:<span style="color:#bbb"> </span>install.package.carvel.dev/v1alpha1<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#000080">kind</span>:<span style="color:#bbb"> </span>PackageRepository<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#000080">metadata</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#000080">name</span>:<span style="color:#bbb"> </span>simple-package-repository<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#000080">spec</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#000080">fetch</span>:<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#000080">image</span>:<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#000080">url</span>:<span style="color:#bbb"> </span>k8slt/corp-com-pkg-repo:1.0.0<span style="color:#bbb">
</span></code></pre></div><p>This CR will allow kapp-controller to install any of the packages found within
the image <code>k8slt/kctrl-pkg-repo:v1.0.0</code>, which is stored in a OCI registry. Save this PackageRepository to
a file named repo.yml and then apply it to the cluster using kapp:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ kapp deploy -a repo -f repo.yml
</code></pre></div><p>Once the deploy has finished, we are able to list the packages and see which ones are now available:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ kubectl get packages
NAME                             PUBLIC-NAME           VERSION      AGE
simple-app.corp.com.1.0.0        simple-app.corp.com   1.0.0        20s
simple-app.corp.com.2.0.0        simple-app.corp.com   2.0.0        20s
simple-app.corp.com.3.0.0-rc.1   simple-app.corp.com   3.0.0-rc.1   20s
</code></pre></div><p>If we want, we can inspect these packages further to get more info about what they&rsquo;re installing:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ kubectl get package pkg.test.carvel.dev.1.0.0 -o yaml
</code></pre></div><p>This will show us the package yaml, which will look something like this:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#555">---</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#000080">apiVersion</span>:<span style="color:#bbb"> </span>package.carvel.dev/v1alpha1<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#000080">kind</span>:<span style="color:#bbb"> </span>Package<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#000080">metadata</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#000080">name</span>:<span style="color:#bbb"> </span>simple-app.corp.com.1.0.0<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#000080">spec</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#000080">publicName</span>:<span style="color:#bbb"> </span>simple-app.corp.com<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#000080">version</span>:<span style="color:#bbb"> </span><span style="color:#099">1.0.0</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#000080">displayName</span>:<span style="color:#bbb"> </span><span style="color:#d14">&#34;simple-app v1.0.0&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#000080">description</span>:<span style="color:#bbb"> </span><span style="color:#d14">&#34;Package for simple-app version 1.0.0&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#000080">template</span>:<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#000080">spec</span>:<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#000080">fetch</span>:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>- <span style="color:#000080">imgpkgBundle</span>:<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#000080">image</span>:<span style="color:#bbb"> </span>k8slt/kctrl-example-pkg:v1.0.0<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#000080">template</span>:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>- <span style="color:#000080">ytt</span>:<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#000080">paths</span>:<span style="color:#bbb">
</span><span style="color:#bbb">          </span>- <span style="color:#d14">&#34;config.yml&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">          </span>- <span style="color:#d14">&#34;values.yml&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">      </span>- <span style="color:#000080">kbld</span>:<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#000080">paths</span>:<span style="color:#bbb">
</span><span style="color:#bbb">          </span>- <span style="color:#d14">&#34;-&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">          </span>- <span style="color:#d14">&#34;.imgpkg/images.yml&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#000080">deploy</span>:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>- <span style="color:#000080">kapp</span>:<span style="color:#bbb"> </span>{}<span style="color:#bbb">
</span></code></pre></div><p>This simple package will fetch the templates stored in the
<code>k8slt/kctrl-example-pkg:v1.0.0</code> bundle, template them using ytt and kbld, and finally
deploy them using kapp. Once deployed, there will be a basic greeter app
running in the cluster. Since this is what we want, we can now move on to installation.</p>
<h2 id="installing-a-package">Installing a package <a href="#installing-a-package" class="section-link">¶</a></h2><p>Once we have the packages available for installation (as seen via <code>kubectl get package</code>) we need to let kapp-controller know what we want to install. To do this, we will need to create an InstalledPackage CR (and a secret to hold the values used by our package):</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#555">---</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#000080">apiVersion</span>:<span style="color:#bbb"> </span>install.package.carvel.dev/v1alpha1<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#000080">kind</span>:<span style="color:#bbb"> </span>InstalledPackage<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#000080">metadata</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#000080">name</span>:<span style="color:#bbb"> </span>pkg-demo<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#000080">namespace</span>:<span style="color:#bbb"> </span>default<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#000080">spec</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#000080">serviceAccountName</span>:<span style="color:#bbb"> </span>default-ns-sa<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#000080">packageRef</span>:<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#000080">publicName</span>:<span style="color:#bbb"> </span>simple-app.corp.com<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#000080">version</span>:<span style="color:#bbb"> </span><span style="color:#099">1.0.0</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#000080">values</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>- <span style="color:#000080">secretRef</span>:<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#000080">name</span>:<span style="color:#bbb"> </span>pkg-demo-values<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#555">---</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#000080">apiVersion</span>:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#000080">kind</span>:<span style="color:#bbb"> </span>Secret<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#000080">metadata</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#000080">name</span>:<span style="color:#bbb"> </span>pkg-demo-values<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#000080">stringData</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#000080">values.yml</span>:<span style="color:#bbb"> </span>|<span style="color:#d14">
</span><span style="color:#d14">    #@data/values
</span><span style="color:#d14">    ---
</span><span style="color:#d14">    hello_msg: &#34;hi&#34;</span><span style="color:#bbb">    
</span></code></pre></div><p>This CR references the package we decided to install in the previous section
using the Package CR&rsquo;s <code>publicName</code> and <code>version</code>. The InstalledPackage also
references the service account which will be used to install the package, as well
as values to include in the templating step in order to customize our installation.</p>
<p>To install above package, we will also need to create <code>default-ns-sa</code> service account (refer to <a href="/kapp-controller/docs/latest/security-model/">Security model</a> for explanation of how service accounts are used) that give kapp-controller privileges to create resources in the default namespace:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ kapp deploy -a default-ns-rbac -f https://raw.githubusercontent.com/vmware-tanzu/carvel-kapp-controller/develop/examples/rbac/default-ns.yml
</code></pre></div><p>Save the InstalledPackage above to a file named installedpkg.yml and then apply the
InstalledPackage using kapp:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ kapp deploy -a pkg-demo -f installedpkg.yml
</code></pre></div><p>After the deploy has finished, kapp-controller will have installed the package in the
cluster. We can verify this by checking the pods to see that we have a workload pod
running. The output should show a single running pod which is part of simple-app:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ kubectl get pods
NAME                          READY   STATUS    RESTARTS   AGE
simple-app-58f865df65-kmhld   1/1     Running   <span style="color:#099">0</span>          2m
</code></pre></div><p>If we now use kubectl&rsquo;s port forwarding functionality, we can also see the our
customized hello message as been used in the workload:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ kubectl port-forward service/simple-app  3000:80
</code></pre></div><p>Then, from another window:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ curl localhost:3000
&lt;h1&gt;Hello hi!&lt;/h1&gt;%
</code></pre></div><p>And we see that our hello_msg value is used.</p>
<h2 id="uninstalling-a-package">Uninstalling a package <a href="#uninstalling-a-package" class="section-link">¶</a></h2><p>To uninstall a package, simply delete the InstalledPackage CR:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ kapp delete -a pkg-demo
</code></pre></div>
          </div>
        </div>
      </div>
    </main>
    <footer>
	<div class="wrapper footer-links">
		<div class="clearfix">
			<ul class="left-links">
				<li><a href="https://twitter.com/carvel_dev"><img src="/img/twitter.png" />Twitter</a></li>
				<li><a href="https://github.com/vmware-tanzu/carvel.dev"><img src="/img/github.svg" />Github</a></li>
				<li><a href="https://kubernetes.slack.com/archives/CH8KCCKA5">
					<img src="/img/slack.png" />
					<span class="desktop">#carvel in Kubernetes Slack</span>
					<span class="mobile">Slack</span>
				</a></li>
			</ul>
			<div class="right-links">
				<a href="/"> <img src="/img/logo.svg" /></a>
			</div>
		</div>
		<div class="bottom-links">
			<p class="copywrite">&copy; 2021 Carvel Authors. <a href="http://vmware.github.io/">A VMware-backed project. <img src="/img/vm-logo.svg" /></a></p>
		</div>
	</div>
</footer>

    
    
      <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
      <script type="text/javascript">
        docsearch({
          apiKey: '582b1408d7a3fe145c0f84f48ca03755',
          indexName: 'carvel',
          inputSelector: '.docsearch-input',
          algoliaOptions: {'facetFilters': ["tags:kapp-controller"], hitsPerPage: 9},
          debug: false 
        });
      </script>
    
  </body>
</html>
