<!DOCTYPE html>
<!-- docs/baseof.html -->
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">

    <link rel="icon" type="image/png" href="/img/favicon.png">
    
    
    <link rel="stylesheet" href="/css/style.css" integrity="" media="screen">
    <script src="/js/main.js" type="text/javascript"></script>
    
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" /> 
  
    
      
      <meta name="robots" content="noindex">
    
    <title>Carvel - kbld - Authentication</title>
  </head>

  <body id="docs">
    

<header class="in-subproject">
	<div class="wrapper">
		<a href="/"><img class="image" src="/img/logo.svg" alt="Carvel Logo" /></a>
		<ul class="desktop-links">
			<li><a href="/" >Home</a></li>
			<li class="subprojects-in-primary-nav">
				<a href="/" onclick="return false;">Projects</a>
				<ul>
					
					
					<li><a href="/ytt/" >ytt</a></li>
					
					
					<li><a href="/kbld/" >kbld</a></li>
					
					
					<li><a href="/kapp/" >kapp</a></li>
					
					
					<li><a href="/imgpkg/" >imgpkg</a></li>
					
					
					<li><a href="https://github.com/vmware-tanzu/carvel-kapp-controller" >kapp-controller</a></li>
					
					
					<li><a href="/vendir/" >vendir</a></li>
					
				</ul>
			</li>
			<li><a href="/community/" >Community</a></li>
			<li><a href="/blog/" >Blog</a></li>
			<li><a href="https://kubernetes.slack.com/archives/CH8KCCKA5"><img src="/img/slack.png" />#carvel in Kubernetes Slack</a></li>
		</ul>
		<button type="button" class="mobile" onclick="mobileNavToggle()">
			<img class="collapsed-icon" src="/img/hamburger.svg" alt="Mobile nav icon">
			<img class="expanded-icon" src="/img/close.svg" alt="Mobile nav icon">
		</button>
		<div id="mobile-menu" class="mobile-menu mobile">
			<ul class="header-links">
				<li><a href="/" >Home</a></li>
				<li>
					<a href="/">Projects</a>
					<ul>
						
						
						<li><a href="/ytt/" >ytt</a></li>
						
						
						<li><a href="/kbld/" >kbld</a></li>
						
						
						<li><a href="/kapp/" >kapp</a></li>
						
						
						<li><a href="/imgpkg/" >imgpkg</a></li>
						
						
						<li><a href="https://github.com/vmware-tanzu/carvel-kapp-controller" >kapp-controller</a></li>
						
						
						<li><a href="/vendir/" >vendir</a></li>
						
					</ul>
				</li>
				<li><a href="/community/" >Community</a></li>
				<li><a href="/blog/" >Blog</a></li>
			</ul>
			<div class="social">
				<a href="https://github.com/vmware-tanzu/carvel.dev"><img src="/img/github.svg" />GitHub</a>
				<a href="https://kubernetes.slack.com/archives/CH8KCCKA5"><img src="/img/slack.png" />#carvel in Kubernetes Slack</a>
			</div>
		</div>
	</div>
</header>



<header class="subproject-specific">
	<div class="wrapper">
		<a href="/kbld/" class="text-logo">kbld</a>
		<ul class="desktop-links">
			<li><a href="/kbld/" >kbld Overview</a></li>
			<li><a href="/kbld/docs/latest/" >Documentation</a></li>
			<li><a href="https://github.com/vmware-tanzu/carvel-kbld"><img src="/img/github.svg" />GitHub</a></li>
		</ul>
		<ul class="mobile-links mobile">
			<li><a href="/kbld/docs/latest/" >Docs</a></li>
			<li><a href="https://github.com/vmware-tanzu/carvel-kbld"><img src="/img/github.svg" />GitHub</a></li>
		</ul>
	</div>
</header>


    <main>
      <div class="wrapper dedicated-page docs clearfix">
        <div class="side-nav">
          
<div class="dropdown">
    
        <span>latest</span>
    
</div>

          
    
    <form class="d-flex align-items-center">
        <span class="algolia-autocomplete" style="position: relative; display: inline-block; direction: ltr;">
        <input type="search" class="form-control docsearch-input" id="search-input" placeholder="Search..."
                aria-label="Search for..." autocomplete="off" spellcheck="false" role="combobox"
                aria-autocomplete="list" aria-expanded="false" aria-owns="algolia-autocomplete-listbox-0"
                dir="auto" style="position: relative; vertical-align: top;">
        </span>
    </form>

          <nav class="navigation">
  
  
  
  
    
    
    
    

    
      <h3>Introduction</h3>
      <ul>
        
          <li>
            
              
              <a href="/kbld/docs/latest/" >About kbld</a>
            
          </li>
        
      </ul>
    
      <h3>Usage</h3>
      <ul>
        
          <li>
            
              
              <a href="/kbld/docs/latest/resolving/" >Resolving images</a>
            
          </li>
        
          <li>
            
              
              <a href="/kbld/docs/latest/building/" >Building images</a>
            
          </li>
        
          <li>
            
              
              <a href="/kbld/docs/latest/packaging/" >Packaging &amp; Relocation</a>
            
          </li>
        
          <li>
            
              
              <a href="/kbld/docs/latest/cnab-image-relocation/" >CNAB Image Mappings</a>
            
          </li>
        
      </ul>
    
      <h3>Reference</h3>
      <ul>
        
          <li>
            
              
              <a href="/kbld/docs/latest/config/" >Configuration</a>
            
          </li>
        
          <li>
            
              
              <a href="/kbld/docs/latest/auth/" class="active">Authentication</a>
            
          </li>
        
      </ul>
    
      <h3>FAQ</h3>
      <ul>
        
          <li>
            
              
              <a href="/kbld/docs/latest/security/" >Security</a>
            
          </li>
        
      </ul>
    
  
</nav>

        </div>
        <div class="docs-content text-content">
          

	


          <div class="documentation-container">
            <h1>Authentication</h1>
            
                <aside>
                <nav id="TableOfContents">
  <ul>
    <li><a href="#via-docker-config">Via Docker config</a></li>
    <li><a href="#via-environment-variables">Via Environment Variables</a></li>
    <li><a href="#gcrio">gcr.io</a></li>
    <li><a href="#aws-ecr">AWS ECR</a></li>
    <li><a href="#harbor">Harbor</a></li>
  </ul>
</nav>
                </aside>
            

            <h2 id="via-docker-config">Via Docker config <a href="#via-docker-config" class="section-link">¶</a></h2><p>Even though <code>kbld</code> commands use registry APIs directly, by default it uses credentials stored in <code>~/.docker/config.json</code> which are typically generated via <code>docker login</code> command.</p>
<p>Example generated <code>~/.docker/config.json</code>:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
  <span style="color:#000080">&#34;auths&#34;</span>: {
    <span style="color:#000080">&#34;https://index.docker.io/v1/&#34;</span>: {
      <span style="color:#000080">&#34;auth&#34;</span>: <span style="color:#d14">&#34;dXNlcjpwYXNzd29yZA==&#34;</span>
    },
  },
  <span style="color:#000080">&#34;HttpHeaders&#34;</span>: {
    <span style="color:#000080">&#34;User-Agent&#34;</span>: <span style="color:#d14">&#34;Docker-Client/18.09.6 (darwin)&#34;</span>
  }
}
</code></pre></div><p>where <code>dXNlcjpwYXNzd29yZA==</code> is <code>base64(&quot;username:password&quot;)</code>.</p>
<h2 id="via-environment-variables">Via Environment Variables <a href="#via-environment-variables" class="section-link">¶</a></h2><p>As of v0.23.0+, kbld can also use following environment variables:</p>
<ul>
<li><code>KBLD_REGISTRY_HOSTNAME</code> to specify registry hostname (e.g. gcr.io, docker.io)</li>
<li><code>KBLD_REGISTRY_USERNAME</code> to specify registry username</li>
<li><code>KBLD_REGISTRY_PASSWORD</code> to specify registry password</li>
</ul>
<p>Since you may need to provide multiple registry credentials, above environment variables multiple times with a suffix like so <code>KBLD_REGISTRY_HOSTNAME_0</code> (suffix can be 1+ alphanumeric characters). Use same suffix for hostname, username and password.</p>
<p>Currently credentials provided via environment variables do not apply when building images with Docker. Continue using <code>docker login</code> to authenticate Docker daemon.</p>
<h2 id="gcrio">gcr.io <a href="#gcrio" class="section-link">¶</a></h2><ul>
<li>Create service account with &ldquo;Storage Admin&rdquo; for push access
<ul>
<li>See <a href="https://cloud.google.com/container-registry/docs/access-control#permissions_and_roles" target="_blank">Permissions and Roles</a></li>
</ul>
</li>
<li>Download JSON service account key and place it somewhere on filesystem (e.g. <code>/tmp/key</code>)
<ul>
<li>See <a href="https://cloud.google.com/container-registry/docs/advanced-authentication#json_key_file" target="_blank">Advanced authentication</a></li>
</ul>
</li>
<li>Run <code>cat /tmp/key | docker login -u _json_key --password-stdin https://gcr.io</code> to authenticate</li>
</ul>
<h2 id="aws-ecr">AWS ECR <a href="#aws-ecr" class="section-link">¶</a></h2><ul>
<li>Create ECR repository</li>
<li>Create IAM user with ECR policy that allows to read/write
<ul>
<li>See <a href="https://docs.aws.amazon.com/AmazonECR/latest/userguide/ecr_managed_policies.html" target="_blank">Amazon ECR Policies</a></li>
</ul>
</li>
<li>Run <code>aws configure</code> and specify access key ID, secret access key and region
<ul>
<li>To install on Ubuntu, run <code>apt-get install pip3</code> and <code>pip3 install awscli</code>
<ul>
<li>See <a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-install.html" target="_blank">Installing the AWS CLI</a></li>
</ul>
</li>
</ul>
</li>
<li>Run <code>eval $(aws ecr get-login --no-include-email)</code> to authenticate
<ul>
<li>See <a href="https://docs.aws.amazon.com/cli/latest/reference/ecr/get-login.html" target="_blank">get-login command</a></li>
</ul>
</li>
</ul>
<p>Example ECR policy from <a href="https://docs.aws.amazon.com/AmazonECR/latest/userguide/ecr_managed_policies.html">https://docs.aws.amazon.com/AmazonECR/latest/userguide/ecr_managed_policies.html</a></p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
  <span style="color:#000080">&#34;Version&#34;</span>: <span style="color:#d14">&#34;2012-10-17&#34;</span>,
  <span style="color:#000080">&#34;Statement&#34;</span>: [
    {
      <span style="color:#000080">&#34;Effect&#34;</span>: <span style="color:#d14">&#34;Allow&#34;</span>,
      <span style="color:#000080">&#34;Action&#34;</span>: [
        <span style="color:#d14">&#34;ecr:GetAuthorizationToken&#34;</span>,
        <span style="color:#d14">&#34;ecr:BatchCheckLayerAvailability&#34;</span>,
        <span style="color:#d14">&#34;ecr:GetDownloadUrlForLayer&#34;</span>,
        <span style="color:#d14">&#34;ecr:GetRepositoryPolicy&#34;</span>,
        <span style="color:#d14">&#34;ecr:DescribeRepositories&#34;</span>,
        <span style="color:#d14">&#34;ecr:ListImages&#34;</span>,
        <span style="color:#d14">&#34;ecr:DescribeImages&#34;</span>,
        <span style="color:#d14">&#34;ecr:BatchGetImage&#34;</span>,
        <span style="color:#d14">&#34;ecr:InitiateLayerUpload&#34;</span>,
        <span style="color:#d14">&#34;ecr:UploadLayerPart&#34;</span>,
        <span style="color:#d14">&#34;ecr:CompleteLayerUpload&#34;</span>,
        <span style="color:#d14">&#34;ecr:PutImage&#34;</span>
      ],
      <span style="color:#000080">&#34;Resource&#34;</span>: <span style="color:#d14">&#34;*&#34;</span>
    }
  ]
}
</code></pre></div><h2 id="harbor">Harbor <a href="#harbor" class="section-link">¶</a></h2><p>You may have to provide <code>--registry-ca-cert-path</code> flag with a path to a CA certificate file for Harbor Registry API.</p>

          </div>
        </div>
      </div>
    </main>
    <footer>
	<div class="wrapper footer-links">
		<div class="clearfix">
			<ul class="left-links">
				<li><a href="https://twitter.com/carvel_dev"><img src="/img/twitter.png" />Twitter</a></li>
				<li><a href="https://github.com/vmware-tanzu/carvel.dev"><img src="/img/github.svg" />Github</a></li>
				<li><a href="https://kubernetes.slack.com/archives/CH8KCCKA5">
					<img src="/img/slack.png" />
					<span class="desktop">#carvel in Kubernetes Slack</span>
					<span class="mobile">Slack</span>
				</a></li>
			</ul>
			<div class="right-links">
				<a href="/"> <img src="/img/logo.svg" /></a>
			</div>
		</div>
		<div class="bottom-links">
			<p class="copywrite">&copy; 2021 Carvel Authors. <a href="http://vmware.github.io/">A VMware-backed project. <img src="/img/vm-logo.svg" /></a></p>
		</div>
	</div>
</footer>

    
    
      <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
      <script type="text/javascript">
        docsearch({
          apiKey: '582b1408d7a3fe145c0f84f48ca03755',
          indexName: 'carvel',
          inputSelector: '.docsearch-input',
          algoliaOptions: {'facetFilters': ["tags:kbld"], hitsPerPage: 9},
          debug: false 
        });
      </script>
    
  </body>
</html>
