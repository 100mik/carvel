<!DOCTYPE html>
<!-- docs/baseof.html -->
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">

    <link rel="icon" type="image/png" href="/img/favicon.png">
    
    
    <link rel="stylesheet" href="/css/style.css" integrity="" media="screen">
    <script src="/js/main.js" type="text/javascript"></script>
    
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" /> 
  
    
      
      <meta name="robots" content="noindex">
    
    <title>Carvel - imgpkg - Commands</title>
  </head>

  <body id="docs">
    

<header class="in-subproject">
	<div class="wrapper">
		<a href="/"><img class="image" src="/img/logo.svg" alt="Carvel Logo" /></a>
		<ul class="desktop-links">
			<li><a href="/" >Home</a></li>
			<li class="subprojects-in-primary-nav">
				<a href="/" onclick="return false;">Projects</a>
				<ul>
					
					
					<li><a href="/ytt/" >ytt</a></li>
					
					
					<li><a href="/kbld/" >kbld</a></li>
					
					
					<li><a href="/kapp/" >kapp</a></li>
					
					
					<li><a href="/imgpkg/" >imgpkg</a></li>
					
					
					<li><a href="https://github.com/vmware-tanzu/carvel-kapp-controller" >kapp-controller</a></li>
					
					
					<li><a href="/vendir/" >vendir</a></li>
					
				</ul>
			</li>
			<li><a href="/community/" >Community</a></li>
			<li><a href="/blog/" >Blog</a></li>
			<li><a href="https://kubernetes.slack.com/archives/CH8KCCKA5"><img src="/img/slack.png" />#carvel in Kubernetes Slack</a></li>
		</ul>
		<button type="button" class="mobile" onclick="mobileNavToggle()">
			<img class="collapsed-icon" src="/img/hamburger.svg" alt="Mobile nav icon">
			<img class="expanded-icon" src="/img/close.svg" alt="Mobile nav icon">
		</button>
		<div id="mobile-menu" class="mobile-menu mobile">
			<ul class="header-links">
				<li><a href="/" >Home</a></li>
				<li>
					<a href="/">Projects</a>
					<ul>
						
						
						<li><a href="/ytt/" >ytt</a></li>
						
						
						<li><a href="/kbld/" >kbld</a></li>
						
						
						<li><a href="/kapp/" >kapp</a></li>
						
						
						<li><a href="/imgpkg/" >imgpkg</a></li>
						
						
						<li><a href="https://github.com/vmware-tanzu/carvel-kapp-controller" >kapp-controller</a></li>
						
						
						<li><a href="/vendir/" >vendir</a></li>
						
					</ul>
				</li>
				<li><a href="/community/" >Community</a></li>
				<li><a href="/blog/" >Blog</a></li>
			</ul>
			<div class="social">
				<a href="https://github.com/vmware-tanzu/carvel.dev"><img src="/img/github.svg" />GitHub</a>
				<a href="https://kubernetes.slack.com/archives/CH8KCCKA5"><img src="/img/slack.png" />#carvel in Kubernetes Slack</a>
			</div>
		</div>
	</div>
</header>



<header class="subproject-specific">
	<div class="wrapper">
		<a href="/imgpkg/" class="text-logo">imgpkg</a>
		<ul class="desktop-links">
			<li><a href="/imgpkg/" >imgpkg Overview</a></li>
			<li><a href="/imgpkg/docs/latest/" >Documentation</a></li>
			<li><a href="https://github.com/vmware-tanzu/carvel-imgpkg"><img src="/img/github.svg" />GitHub</a></li>
		</ul>
		<ul class="mobile-links mobile">
			<li><a href="/imgpkg/docs/latest/" >Docs</a></li>
			<li><a href="https://github.com/vmware-tanzu/carvel-imgpkg"><img src="/img/github.svg" />GitHub</a></li>
		</ul>
	</div>
</header>


    <main>
      <div class="wrapper dedicated-page docs clearfix">
        <div class="side-nav">
          
<div class="dropdown">
    
        <span>latest</span>
    
</div>

          
    
    <form class="d-flex align-items-center">
        <span class="algolia-autocomplete" style="position: relative; display: inline-block; direction: ltr;">
        <input type="search" class="form-control docsearch-input" id="search-input" placeholder="Search..."
                aria-label="Search for..." autocomplete="off" spellcheck="false" role="combobox"
                aria-autocomplete="list" aria-expanded="false" aria-owns="algolia-autocomplete-listbox-0"
                dir="auto" style="position: relative; vertical-align: top;">
        </span>
    </form>

          <nav class="navigation">
  
  
  
  
    
    
    
    

    
      <h3>Introduction</h3>
      <ul>
        
          <li>
            
              
              <a href="/imgpkg/docs/latest/" >About imgpkg</a>
            
          </li>
        
      </ul>
    
      <h3>Workflows</h3>
      <ul>
        
          <li>
            
              
              <a href="/imgpkg/docs/latest/basic-workflow/" >Basic workflow</a>
            
          </li>
        
          <li>
            
              
              <a href="/imgpkg/docs/latest/air-gapped-workflow/" >Air-gapped workflow</a>
            
          </li>
        
      </ul>
    
      <h3>Reference</h3>
      <ul>
        
          <li>
            
              
              <a href="/imgpkg/docs/latest/auth/" >Authentication</a>
            
          </li>
        
          <li>
            
              
              <a href="/imgpkg/docs/latest/resources/" >Resources</a>
            
          </li>
        
          <li>
            
              
              <a href="/imgpkg/docs/latest/commands/" class="active">Commands</a>
            
          </li>
        
          <li>
            
              
              <a href="/imgpkg/docs/latest/working-directly-with-images/" >Working directly with images</a>
            
          </li>
        
      </ul>
    
      <h3>FAQ</h3>
      <ul>
        
          <li>
            
              
              <a href="/imgpkg/docs/latest/security/" >Security</a>
            
          </li>
        
      </ul>
    
  
</nav>

        </div>
        <div class="docs-content text-content">
          

	


          <div class="documentation-container">
            <h1>Commands</h1>
            
                <aside>
                <nav id="TableOfContents">
  <ul>
    <li><a href="#push">Push</a>
      <ul>
        <li><a href="#overview">Overview</a></li>
        <li><a href="#generating-a-bundlelock">Generating a BundleLock</a></li>
      </ul>
    </li>
    <li><a href="#pull">Pull</a>
      <ul>
        <li><a href="#overview-1">Overview</a></li>
        <li><a href="#pulling-via-lock-file">Pulling via lock file</a></li>
        <li><a href="#pulling-nested-bundles">Pulling nested bundles</a></li>
      </ul>
    </li>
    <li><a href="#copy">Copy</a>
      <ul>
        <li><a href="#overview-2">Overview</a></li>
        <li><a href="#copying-via-lock-file">Copying via lock file</a></li>
        <li><a href="#non-distributable-or-foreign-layers">Non-Distributable or Foreign Layers</a></li>
      </ul>
    </li>
    <li><a href="#tag">Tag</a></li>
  </ul>
</nav>
                </aside>
            

            <h2 id="push">Push <a href="#push" class="section-link">¶</a></h2><h3 id="overview">Overview <a href="#overview" class="section-link">¶</a></h3><p><code>push</code> command allows users to create a bundle in the registry from files and/or directories on their local file systems. For example,</p>
<pre><code class="language-bash-plain" data-lang="bash-plain">$ imgpkg push -b index.docker.io/k8slt/sample-bundle -f my-bundle/
</code></pre><p>will push a bundle contents containing in the <code>my-bundle/</code> directory to <code>index.docker.io/k8slt/sample-bundle</code>.</p>
<p>Use the <code>-b</code>/<code>--bundle</code> flag to specify the destination of the push. If the specified destination does not include a tag, the artifact will be pushed with the default tag <code>:latest</code>.</p>
<p>The <code>-f</code> flag can be used multiple times to add different files or directories to the bundle.</p>
<h3 id="generating-a-bundlelock">Generating a BundleLock <a href="#generating-a-bundlelock" class="section-link">¶</a></h3><p><code>push</code> command can output a <a href="/imgpkg/docs/latest/resources/#bundlelock-configuration"><code>BundleLock</code> configuration</a> for users that would like a deterministic reference to a pushed bundle. For example, running:</p>
<pre><code class="language-bash-plain" data-lang="bash-plain">$ impgpkg push -b index.docker.io/k8slt/sample-bundle:v0.1.0 -f my-bundle/ --lock-output
/tmp/bundle.lock.yml
</code></pre><p>will create <code>/tmp/bundle.lock.yml</code> with BundleLock configuration. If another bundle image in the repository is later given the same tag (<code>v0.1.0</code>), the BundleLock configuration will continue to provide immutable reference (via digest) to the original pushed bundle.</p>
<hr>
<h2 id="pull">Pull <a href="#pull" class="section-link">¶</a></h2><h3 id="overview-1">Overview <a href="#overview-1" class="section-link">¶</a></h3><p>After pushing bundles to a registry, users can retrieve them with <code>imgpkg pull</code>. For example,</p>
<pre><code class="language-bash-plain" data-lang="bash-plain">$ imgpkg pull -b index.docker.io/k8slt/sample-bundle -o my-bundle/
</code></pre><p>will pull a bundle from <code>index.docker.io/k8slt/sample-bundle</code> and extract its contents into the <code>my-bundle/</code> directory, which gets created if it does not already exist.</p>
<p>When pulling a bundle, imgpkg ensures that the referenced images are updated to account for any relocations. It will search for each referenced image by digest in the same repository as the bundle. If all referenced digests are found, imgpkg will update image references in the bundle&rsquo;s <a href="/imgpkg/docs/latest/resources/#imgpkg-directory"><code>.imgpkg/images.yml</code> file</a>. If any of the digests are not found in the repository, imgpkg will not update any references.</p>
<h3 id="pulling-via-lock-file">Pulling via lock file <a href="#pulling-via-lock-file" class="section-link">¶</a></h3><p><a href="/imgpkg/docs/latest/resources/#bundlelock-configuration">BundleLock configuration</a> can be used as input to the pull command via the <code>--lock</code> flag.</p>
<pre><code class="language-bash-plain" data-lang="bash-plain">$ imgpkg pull --lock bundle.lock.yml -o my-bundle/
</code></pre><h3 id="pulling-nested-bundles">Pulling nested bundles <a href="#pulling-nested-bundles" class="section-link">¶</a></h3><p>If pulling a bundle that references another bundle (via it&rsquo;s ImagesLock file), in order to <em>also</em> pull down the contents of every nested bundle, use the <code>--recursive</code> flag.</p>
<pre><code class="language-bash-plain" data-lang="bash-plain">$ imgpkg pull --recursive -b bundle-with-nested-bundles
</code></pre><p>Contents of <em>every</em> nested bundle are written to the &lsquo;parent&rsquo; bundle&rsquo;s <code>.imgpkg/bundles</code> directory, namespaced by the bundle&rsquo;s sha256.</p>
<p>For e.g. pulling a bundle with a nested bundle having sha of <code>123</code> would result in:</p>
<pre><code>parent-bundle-path/.imgpkg/bundles/sha256-123/&lt;nested bundle 123 contents written here&gt;
</code></pre><hr>
<h2 id="copy">Copy <a href="#copy" class="section-link">¶</a></h2><h3 id="overview-2">Overview <a href="#overview-2" class="section-link">¶</a></h3><p>The <code>copy</code> command copies a bundle from a registry to another registry (as long as both registries are accessible from where the command is running):</p>
<pre><code class="language-bash-plain" data-lang="bash-plain">$ imgpkg copy -b index.docker.io/k8slt/sample-bundle --to-repo registry.corp.com/user2/sample-bundle-name
</code></pre><p>Alternatively <code>copy</code> can copy a bundle between registries which are not both accessible from a single location, by creating an intermediate tarball:</p>
<pre><code class="language-bash-plain" data-lang="bash-plain">$ imgpkg copy -b index.docker.io/k8slt/sample-bundle --to-tar=/Volumes/secure-thumb/bundle.tar
# ... take thumb driver to a different location ...
$ imgpkg copy --tar=/Volumes/secure-thumb/bundle.tar --to-repo registry.corp.com/user2/sample-bundle-name
</code></pre><p>In either case, the bundle image and all dependent images are copied to the destination location <code>registry.corp.com/user2/sample-bundle-name</code>.</p>
<h3 id="copying-via-lock-file">Copying via lock file <a href="#copying-via-lock-file" class="section-link">¶</a></h3><p><a href="/imgpkg/docs/latest/resources/#bundlelock-configuration">BundleLock configuration</a> can be used as input to the copy command via the <code>--lock</code> flag.</p>
<pre><code class="language-bash-plain" data-lang="bash-plain">$ imgpkg copy --lock bundle.lock.yml --to-repo registry.corp.com/user2/sample-bundle-name --lock-output /tmp/new-bundle.lock.yml
</code></pre><h3 id="non-distributable-or-foreign-layers">Non-Distributable or Foreign Layers <a href="#non-distributable-or-foreign-layers" class="section-link">¶</a></h3><p>Some images contain layers which should not be uploaded when copying, such as a proprietary base image.
Instead, to comply with license requirements, it is expected to get them directly from the source registry.
These layers are interchangeably known as
<a href="https://github.com/opencontainers/image-spec/blob/79b036d80240ae530a8de15e1d21c7ab9292c693/layer.md#non-distributable-layers" target="_blank">Non-Distributable</a>
(by the OCI) or
<a href="https://docs.docker.com/registry/spec/manifest-v2-2/" target="_blank">Foreign</a> (by Docker) and denoted in the layer&rsquo;s MediaType.</p>
<p>By default, imgpkg will not relocate any layers marked as non-distributable.</p>
<p>This can cause issues when dealing with <a href="/imgpkg/docs/latest/air-gapped-workflow/">air-gapped environments</a> as they may be unable to reach the external registries.
To allow this use case, imgpkg supports the <code>--include-non-distributable</code> flag to copy all layers, even those marked as non-distributable.</p>
<p>Note that usage of this flag shall not preclude your obligation to comply with the terms of the image license(s).</p>
<hr>
<h2 id="tag">Tag <a href="#tag" class="section-link">¶</a></h2><p><code>imgpkg tag</code> supports a <code>list</code> subcommand that allows users to list the image tags pushed to registries. The command features an <code>--image</code>/<code>-i</code> option that allows a user to specify an image name.</p>
<p>An example of this is shown below:</p>
<pre><code class="language-bash-plain" data-lang="bash-plain">$ imgpkg tag list -i index.docker.io/k8slt/image
</code></pre><p>The output shows the names of all tags associated with the image, along with its digest.</p>

          </div>
        </div>
      </div>
    </main>
    <footer>
	<div class="wrapper footer-links">
		<div class="clearfix">
			<ul class="left-links">
				<li><a href="https://twitter.com/carvel_dev"><img src="/img/twitter.png" />Twitter</a></li>
				<li><a href="https://github.com/vmware-tanzu/carvel.dev"><img src="/img/github.svg" />Github</a></li>
				<li><a href="https://kubernetes.slack.com/archives/CH8KCCKA5">
					<img src="/img/slack.png" />
					<span class="desktop">#carvel in Kubernetes Slack</span>
					<span class="mobile">Slack</span>
				</a></li>
			</ul>
			<div class="right-links">
				<a href="/"> <img src="/img/logo.svg" /></a>
			</div>
		</div>
		<div class="bottom-links">
			<p class="copywrite">&copy; 2021 Carvel Authors. <a href="http://vmware.github.io/">A VMware-backed project. <img src="/img/vm-logo.svg" /></a></p>
		</div>
	</div>
</footer>

    
    
      <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
      <script type="text/javascript">
        docsearch({
          apiKey: '582b1408d7a3fe145c0f84f48ca03755',
          indexName: 'carvel',
          inputSelector: '.docsearch-input',
          algoliaOptions: {'facetFilters': ["tags:imgpkg"], hitsPerPage: 9},
          debug: false 
        });
      </script>
    
  </body>
</html>
